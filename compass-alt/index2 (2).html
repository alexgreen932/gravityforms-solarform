<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link type="text/css" rel="stylesheet" href="../assets/css/style.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/all.min.css">
    <script src="../assets/js/jquery-3.7.1.min.js"></script>
    <script src="../assets/js/vue.js"></script>
    <!-- <script src="../assets/js/script.js"></script> -->
    <style>
        @import url("https://fonts.googleapis.com/css?family=Montserrat:400,400i,700");


    </style>
</head>

<body>
    <div id="app">
        <div id="wrap">
            <div id="cover-circle"></div>
            <div id="labRat">
                <div id="knobTr"></div>
            </div>
            <div id="volumeBarCont">
                <div id="volumeBar">
                    <div id="volumeLevelWrap">
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                        <div class="levelBar"></div>
                    </div>
                </div>
                <span>0%</span>
            </div>
        </div>
    </div>
    <script type="module">
        let knobTrigger = document.querySelector("#knobTr"),
            knob = document.querySelector("#labRat"),
            wrap = document.querySelector("#wrap"),
            // volumeCont = document.querySelector("#volumeBarCont"),
            volumeBar = document.querySelector("#volumeBar"),
            // volumePercent = document.querySelector("#volumeBarCont span"),
            fadeOut;

        function valBetween(v, min, max) {
            return Math.min(max, Math.max(min, v));
        }

        knobTrigger.addEventListener("mousedown", e => {
            let x0 = knob.getBoundingClientRect().left + knob.offsetWidth / 2,
                y0 = knob.getBoundingClientRect().top + knob.offsetHeight / 2;

            let p2 = {
                x: x0,
                y: y0
            };
            if (e.button === 0) {
                let rotateKnob = function (e) {
                    let p1 = {
                        x: e.clientX,
                        y: e.clientY
                    },

                    // angle in degrees
                    angleDeg = -Math.atan2(p1.x - p2.x, p1.y - p2.y) * 180 / Math.PI + 180;
                    let percentValue = parseInt((valBetween(angleDeg, 45, 315) - 315) / -2.7);
                    console.log(p2.x, p1.x);
                    clearTimeout(fadeOut);
                    // fadeOut = setTimeout(() => {
                    //     volumeCont.style.opacity = 0;
                    // }, 3000);
                    // volumeCont.style.opacity = 1;

                    knob.style.transform =
                        "rotateZ(" + (valBetween(angleDeg, 45, 315) - 315) + "deg)";
                    volumePercent.innerHTML = percentValue + "%";
                    if (percentValue % 5 === 0) {
                        volumeBar.style.width = percentValue * 2.4 + "px";
                    } else {
                        return false;
                    }
                };
                document.addEventListener("mousemove", rotateKnob, false);
                document.addEventListener("mouseup", e => {
                    document.removeEventListener("mousemove", rotateKnob, false);
                });
            } else {
                return false;
            }
        });

        wrap.addEventListener("contextmenu", e => {
            e.preventDefault();
        });



    </script>
</body>

</html>